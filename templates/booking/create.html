{% extends 'base.html' %}

{% block title %}预订 - {{ attraction.name }}{% endblock %}

{% block extra_css %}
<style>
    /* 预定页面卡片头部样式 */
    .booking-create-card-header {
        background-color: #FAA331 !important;
        border-color: #FAA331 !important;
    }
    
    /* 预定页面按钮样式 */
    .booking-create-btn-primary {
        background-color: #FAA331 !important;
        border-color: #FAA331 !important;
        color: #fff !important;
    }
    
    .booking-create-btn-primary:hover {
        background-color: #e8921f !important;
        border-color: #e8921f !important;
        color: #fff !important;
    }
    
    .booking-create-btn-primary:focus,
    .booking-create-btn-primary:active {
        background-color: #d8820d !important;
        border-color: #d8820d !important;
        color: #fff !important;
        box-shadow: 0 0 0 0.25rem rgba(250, 163, 49, 0.5) !important;
    }
    
    /* 预定页面信息提示框样式 */
    .booking-create-alert-info {
        background-color: #fff3e0 !important;
        border-color: #FAA331 !important;
        color: #8b4513 !important;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header bg-primary booking-create-card-header text-white">
                    <h4 class="mb-0">预订：{{ attraction.name }}</h4>
                </div>
                <div class="card-body">
                    <!-- 景点信息展示 -->
                    <div class="row mb-4">
                        <div class="col-md-4">
                            {% if attraction.image %}
                                <img src="{{ attraction.image.url }}" class="img-fluid rounded" alt="{{ attraction.name }}">
                            {% endif %}
                        </div>
                        <div class="col-md-8">
                            <h5>{{ attraction.name }}</h5>
                            <p class="text-muted">{{ attraction.get_region_display }}</p>
                            <p class="text-danger h4">￥{{ attraction.price }} / 张</p>
                        </div>
                    </div>
                    
                    <hr>
                    
                    <!-- 预订表单 -->
                    <form method="post">
                        {% csrf_token %}
                        
                        <div class="mb-3">
                            <label for="{{ form.visit_date.id_for_label }}" class="form-label">{{ form.visit_date.label }}</label>
                            {{ form.visit_date }}
                            {% if form.visit_date.errors %}
                                <div class="text-danger small">{{ form.visit_date.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.quantity.id_for_label }}" class="form-label">{{ form.quantity.label }}</label>
                            {{ form.quantity }}
                            {% if form.quantity.errors %}
                                <div class="text-danger small">{{ form.quantity.errors }}</div>
                            {% endif %}
                            <small class="text-muted">最多可预订10张</small>
                        </div>
                        
                        <div class="alert alert-info booking-create-alert-info">
                            <strong>单价：</strong>￥{{ attraction.price }} × <span id="quantity-display">1</span> 张 = 
                            <strong class="text-danger" id="total-price">￥{{ attraction.price }}</strong>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg booking-create-btn-primary">确认预订</button>
                            <a href="{% url 'attractionsApp:attraction_detail' attraction.id %}" class="btn btn-outline-secondary">返回</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script>
    // 实时计算总价
    document.getElementById('{{ form.quantity.id_for_label }}').addEventListener('input', function() {
        const quantity = parseInt(this.value) || 1;
        const price = {{ attraction.price }};
        const total = price * quantity;
        
        document.getElementById('quantity-display').textContent = quantity;
        document.getElementById('total-price').textContent = '￥' + total.toFixed(2);
    });
</script>
{% endblock %}
{% endblock %}

